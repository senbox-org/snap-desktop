<!--
  ~ Copyright (C) 2010 Brockmann Consult GmbH (info@brockmann-consult.de)
  ~
  ~ This program is free software; you can redistribute it and/or modify it
  ~ under the terms of the GNU General Public License as published by the Free
  ~ Software Foundation; either version 3 of the License, or (at your option)
  ~ any later version.
  ~ This program is distributed in the hope that it will be useful, but WITHOUT
  ~ ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  ~ FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
  ~ more details.
  ~
  ~ You should have received a copy of the GNU General Public License along
  ~ with this program; if not, see http://www.gnu.org/licenses/
  -->

<html>
<head>
    <title>Sentinel Toolbox Help - Color Manipulation / Colour Manipulation</title>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <link rel="stylesheet" href="../style.css">
</head>

<body>
<table class="header">
    <tr class="header">
        <td class="header">&nbsp;
            Color / Colour Manipulation
        </td>

        <td class="header" align="right"><a href="../general/overview/SnapOverview.html"><img
                src="../images/snap_header.jpg"
                border="0"></a></td>
    </tr>
</table>

<p>Note: this help page in general uses the spelling "color".  Depending on the branding of your
    SNAP application, elsewhere in your application the spelling may be "colour"</p>


<h3>Overview</h3>


<p>This tool
    is used to modify the color palette mapping used in the image.  If you are opening an Image View of a
    band or tie-point grid, the image loads with the color settings of the band
    stored within the data file itself (BEAM-DIMAP format only) or for other files it applies default color
    settings as defined in the
    <a href="ColorManipulationPreferences.html">Preferences</a> (/Tools/Options/Color Manipulation).

</p>

<p>Depending on the type of the source data used for the images and the type of images to be created,
    this tool offers three editor modes: Basic, Sliders and Table.
    If the source data is a single spectral/geophysical band, then the Basic, Sliders and Table mode editors are all
    used. If
    the source data is an indexed band then only the Table editor is used. If the source data is 3 bands used to create
    a RGB
    image then only the Sliders editor is used.
</p>

<p>To open the Color Manipulation tool window, use the corresponding icon
    <img src="images/icons/ContrastStretch24.gif" alt="Contrast/Palette Window" border="0">
    in the "Tool Windows" toolbar or select <i>/Tool Windows/Color Manipulation</i>
    from the main menu. Changes made within the Color Manipulation tool window will directly become effective in the
    image of the currently selected band.
</p>


<br>
<hr>
<h4>Some Common Functions</h4>
<b>Each editor mode (Basic, Sliders, Table) in this tool has unique parameters but all editors share
    the following common functions:</b>

<ul>
    <li> <img src="images/icons/Undo24.gif"> &nbsp; The "Reset" button resets to the default settings.  In the case of a
        single spectral/geophysical band it applies the default color scheme if applicable.
    </li>

    <li> <img src="images/icons/LogDisplay24.png"> &nbsp; The "Log Scaling" button toggles the log scaling and applies
        it to the image.  This option is not available in the RGB image and for the index band source.  For the RGB
        image, any concept of log scaling needs to be either contained within the configuration profile, or you can
        use the "Gamma non-linearity" feature within "More Options".
    </li>

    <li> <img src="images/icons/MultiAssign24.gif"> &nbsp; The "Apply to Other Bands" button enables you to apply/load
        the color palette into any other band which is opened in a view window.
    </li>


    <li> <img src="images/icons/document-open.png"> &nbsp; The "Import Palette" button enables you to import a palette
        file (cpd or cpt).  Essentially this functions identically to the color palette chooser except that this is a
        dialog selector displaying the files.
    </li>

    <li> <img src="images/icons/document-save.png"> &nbsp; The "Export Palette" button enables you to export a "custom"
        palette file (cpd, cpt, or pal) from the current parameters.
    </li>
</ul>


<br>
<hr>
<h4>Basic Editor</h4>

<p> The "Basic" editor is only used when the source data is a single spectral/geophysical band.
    In this editor you can select the color palette, the range (minimum and maximum), and whether the scaling
    is logarithmic. These 3 parameters (palette, range and scaling) define a color scheme. You may either select
    a pre-defined color scheme or individually adjust any of the parameters. Note that a color scheme can
    automatically be applied when an image window is opened based on the band name (see <a
            href="ColorManipulationPreferences.html">Preferences</a>).
</p>

<br>
<div align="center">
    <table>
        <tr>
            <td align="center" style="border-width:0"><img src="images/Color_Basic.png"/></td>
        </tr>
        <tr>
            <td align="center" style="border-width:0">
                <b>A.1</b>: Basic mode editor<br> (for images of a single, spectral/geophysical band)
            </td>
        </tr>
    </table>
</div>
<br>

<p><b><i>Scheme</i></b>: This section handles the setting and display of the color scheme.
</p>
<ul>
    <li><b>Scheme Selector</b>: This selector is used to specify a pre-defined color scheme. Once you choose a color
        scheme, all components
        and the image will be updated with the parameters (palette, range and scaling) of the color scheme. These color
        schemes are configured in xml files.  A user editable file for custom schemes is at
        (~/.snap/auxdata/color_schemes/color_palette_schemes_user.xml or ~/.seadas8/auxdata/color_schemes/color_palette_schemes_user.xml).
        If a scheme was automatically applied via bandname-lookup
        when you opened the view window of the band, then this selector should display the scheme which has been applied.
        Any subsequent changes to scheme parameters will cause this selector to be set to "None" (indicating that the
        scheme no longer is being used in the image).
    </li>
</ul>

<p><b><i>Palette</i></b>: This section enables you to load in a color palette.
</p>
<ul>
    <li><b>Color Palette Chooser</b>: used to select pre-defined color palettes. These palettes are stored in
        (~/.snap/auxdata/color_palettes).
        There are currently two supported formats of these palettes: cpd and cpt. CPD is the native format (BEAM, SNAP
        and SeaDAS).
        CPT is the format used in the Generic Mapping Tools software. Each of these formats contain not only the color
        ramp,
        but actual data values for each point in the ramp. When you select the palette, those data values will
        automatically
        be redistributed across the range (Min, Max) currently displayed in the Basic window. The palettes weighting
        between
        points is preserved during this redistribution.
    </li>
    <li><b>Load exact values</b>: This checkbox when checked affects the behavior of the Color Palette Chooser. If
        checked, then when a palette
        is selected the points are not redistributed to the range but instead the exact data of the palette is used.
    </li>
    <li><b>Reverse</b>: This button enables you to reverse the direction of the color palette.
    </li>
</ul>


<p><b><i>Range</i></b>: This section enables you to adjust the min and max of the color palettes. Any change to these
    fields
    will cause the color palette to redistribute based on this range, while retaining any current distribution point
    weighting factors contained within the currently loaded palette. To alter the distribution see the "Sliders" and the
    "Table" editors.
</p>
<ul>
    <li><b>Min</b>: This textfield sets the image data value to use for the first point of the color palette. The first
        palette point color
        will be applied to all pixels with values below this minimum value.
    </li>

    <li><b>Min</b>: This textfield sets the image data value to use for the last point of the color palette. The last
        palette point color
        will be applied to all pixels with values above this maximum value.
    </li>


    <li><b>From Palette</b>: This button loads in the range settings from the palette file which was originally loaded
        within the palette
        chooser while maintaining any subsequent user alterations of the point distribution.
    </li>

    <li><b>From Data</b>: This button loads in the
        range obtained from the statistics of the data (min and max percentile of the data - see Preferences). If you wish to load other
        statistical
        ranges based on a histogram of the data see the "Sliders" editor.
        </p>
    </li>
</ul>


<br>
<hr>
<h4>Sliders Editor</h4>

<p> In the "Slider" mode you have control over how the individual points of the color palette are distributed.
    You also have features associated with using the statistics and histogram of the data. The histogram
    is displayed over the applied color palette with adjustable sliders for each point of the palette.
</p>


<div align="center">
    <table>
        <tr>
            <td align="center" style="border-width:0"><img src="images/Color_Sliders.png"/></td>
        </tr>
        <tr>
            <td align="center" style="border-width:0">
                <b>A.2</b>: Sliders mode editor<br> for images of a single, spectral/geophysical band
            </td>
        </tr>
    </table>
</div>

<p><b>Modifying the Sliders</b>: Various aspects including color and position may be modified here, as well as adding
    and removing sliders.
</p>

<ul>
    <li><b>Color/Transparency</b>: To change the color/transparency of a slider, left-click on the slider and a variety
        of color selection
        options are available. One
        option is "None" which makes the color bar at the slider location fully transparent. The transparency is a
        linear
        progression
        between the adjacent sliders. More colors and partial transparency is available within the "More" option.
    </li>

    <li><b>Value</b>: To change the data value of a slider you may either click on the slider and move it, or left-click
        on the slider's label text
        and directly enter a new value in the textfield popup.
    </li>

    <li><b>Add Slider</b> To add a new slider, right click anywhere on the color bar between two existing slider and
        select "Add new
        Slider". A
        new slider will be inserted
        beneath the location of the mouse-click with its value and its colors set automatically by a linear
        interpolation of
        the
        adjacent sliders.
    </li>

    <li><b>Remove Slider</b> To remove a slider, right click on the slider and select "Remove Slider". The palette will
        then be updated by interpolating
        between the adjacent remaining sliders
    </li>

    <li><b>Center Slider Position</b> To center a slider spatially between two adjacent slider, right click on the
        slider and select "Center Slider
        Position"
    </li>

    <li><b>Center Slider Color</b> To center a slider in color-space between two adjacent slider, right click on the
        slider and select "Center Slider Color"
    </li>

</ul>

<p><b>Statistical Information</b>: If the information <font color="red">Rough statistics!</font> is shown, the statistical information is computed on a
    sub-sampled level. You can click it in order to compute the accurate statistical data
</p>



<p><b>Range Auto-Adjust</b>: Several buttons are available to auto-adjusted the range of the color palette. More
    range auto-adjust buttons can be added as well by setting your <a href="ColorManipulationPreferences.html">Preferences</a>.
</p>
<ul>
    <li>
        <img src="images/icons/Auto1SigmaPercent24.gif">
        &nbsp; adjusts the palette range to cover 1&sigma; (68.27%) of all pixels in the band.
    </li>

    <li>
        <img src="images/icons/Auto2SigmaPercent24.gif">
        &nbsp; adjusts the palette range to cover 2&sigma; (95.45%) of all pixels in the band.
    </li>

    <li>
        <img src="images/icons/Auto3SigmaPercent24.gif">
        &nbsp; adjusts the palette range to cover 3&sigma; (99.73%) of all pixels in the band.
    </li>

    <li>
        <img src="images/icons/Auto95Percent24.gif">
        &nbsp; adjusts the palette range to cover 95% of all pixels in the band.
    </li>

    <li>
        <img src="images/icons/Auto100Percent24.gif">
        &nbsp; adjusts the palette range to cover 100% (the full range) of all pixels in the band.
    </li>

    <li>
        <img src="images/icons/AutoPresetRange24.png">
        &nbsp; adjusts the palette range to a specific pre-set value (RGB mode only - see preferences).
    </li>
</ul>

<p><b>Histogram View Zoom</b>: There are several zoom options for viewing the histogram over color palette image.
</p>

<ul>
    <li>
        <img src="images/icons/ZoomIn24V.gif">
        &nbsp; Progressively zooms in to the histogram vertically
    </li>

    <li>
        <img src="images/icons/ZoomOut24V.gif">
        &nbsp; Progressively zooms out of the histogram vertically.
    </li>

    <li><img src="images/icons/ZoomHorizontal24.gif">
        &nbsp; Toggles the horizontal zoom between the palette range bounds and the full data range.
    </li>
</ul>

<p><b>Slider Distribution</b>: The sliders can be distributed all at once.
</p>
<ul>
    <li>
        <img src="images/icons/EvenDistribution.gif">
        &nbsp; Distributes the inner sliders evenly between the first and the last slider.
    </li>
</ul>

<p><b>RGB Images</b> The "Sliders" editor is also used for RGB images, in which case these is a red, green, and blue sliders channels</p>


<div align="center">
    <table>
        <tr>
            <td align="center" style="border-width:0"><img src="images/Color_RGB1.png"/><br>&nbsp;</td>
        </tr>
        <tr>
            <td align="center" style="border-width:0"><img src="images/Color_RGB2.png"/><br>&nbsp;</td>
        </tr>
        <tr>
            <td align="center" style="border-width:0"><img src="images/Color_RGB3.png"/><br>&nbsp;</td>
        </tr>
        <tr align="center">
            <td colspan="3" align="center" style="border-width:0">
                <b>C.</b> Editor for images using separate R,G,B channels
            </td>
        </tr>
    </table>
</div>


<p>In this mode the sliders are used for contrast stretching in each of the R,G,B channels.
    In the <b>More Options</b> panels, you can adjust the <b><a href="#nodata">No-Data Color</a></b> and
    <b><a href="#histomatch">Histogram Matching</a></b> for the final image. The <b>Source Band</b> and <b>Gamma</b>
    options
    apply to each channel. The gamma value is used to adapt the transfer function which quantises the band's
    sample values to color values. A gamma value of <code>0.7</code> for the blue channel enhances most
    RGB images.
</p>


<br>
<hr>
<h4>Table Editor</h4>

<p>In the "Table" mode you can select the color and specify the data value of each point

</p>
<div align="center">
    <table>
        <tr>
            <td colspan="2" align="center" style="border-width:0; padding-top: 15px;"><img
                    src="images/Color_Table.png"/></td>
        </tr>
        <tr>
            <td colspan="2" align="center" style="border-width:0">
                <b>A.3</b>: Editor for images of a single, spectral/geophysical band
                in <b>Table</b> mode
            </td>
        </tr>
    </table>
</div>

<p> The "Table" editor is also used for index bands.

</p>

<div align="center">
    <table>
        <tr>
            <td align="center" style="border-width:0"><img src="images/Color_IndexBand.png"/></td>
        </tr>
        <tr align="center">
            <td align="center" style="border-width:0">
                <b>B.</b>: Editor for images of a single, index-coded band
            </td>
        </tr>
    </table>
</div>


<p>Images of a single, index-coded band, e.g. the output of a look-up discrete colors from a
    fixed-size table</p>

<p>Labels and colors are simply changed by clicking into the corresponding table cell.
    In the <b>More Options</b> panels you can adjust the <b><a href="#nodata">No-Data Color</a></b>.</p>







<br>
<hr>
<h3>More Options</h3>

<h4><a name="nodata">No-Data Color</a></h4>

<p>In the <b>More Options</b> panel of all editors you can adjust the <b>No-Data Color</b>.
    This color will be used for no-data pixels in the source band(s).
    If you select <b>None</b>, no-data sample will be transparent in the image.</p>

<h4><a name="histomatch">Histogram Matching</a></h4>

<p>It is sometimes desirable to transform an image so that its histogram matches that of a
    specified functional form. It is possible to apply an equalized or normalized
    histogram matching to images which can often improve image quality.
</p>

<h4><a name="discrete">Discrete Colors</a></h4>

<p>Sometimes it is needed that an image is classified by value ranges. Each value range should be displayed with a
    defined color.
    To toggle the use of discrete colors use the discrete color checkbox. Each slider position defines the
    start or the end of a value range. The color of an image pixel is defined by the following rule:
</p>
<pre>
            lsc = leftSliderColor
            lsv = leftSliderValue
            rsv = rightSliderValue
            vop = valueOfImagePixel
            if (vop >= lsv && vop < rsv) then pixelColor = lsc
</pre>

<br>
<p align="center">
    <img src="images/CM_not_discrete.png">&nbsp;&nbsp;<img src="images/CM_not_discrete_chlor.png"><br>
    <b>Discrete colors 'off'</b><br><br>
</p>

<p align="center">
    <img src="images/CM_discrete.png">&nbsp;&nbsp;<img src="images/CM_discrete_chlor.png"><br>
    <b>Discrete colors 'on'</b><br><br>
</p>



<h4>Other Related Export Options</h4>


<p>The color palette information used for the current image can also be exported into an image file.
    Click the context menu item <a href="ExportColorLegend.html">Export Color Legend</a>
    over an open image view in order export the color legend.
</p>

<p>The color palette can be also exported as a <a href="ExportColorPalette.html">Color Palette Table</a>.
    Choose from the <b>File</b> menu <b>Color Palette</b> to export the table as a *.csv or *.txt file.
</p>







<h4>Extra information</h4>

<p>The information icon <img src="images/icons/Information24.gif"> is used to toggle the visibility of the extra
    information area.
</p>

<h4><a name="contexthelp">Context help</a></h4>

<p> The help icon <img src="images/icons/Help22.png"> opens the Help for the current context.
</p>


<hr>
</body>
</html>